#Change names of individual sequences to add species name both nt and aa
	#also done in 1_ file but here for redundancy in case I start with this file for efficiency during data exploration
perl -pi -e 's/\>TRINITY/\>PAN_/g' sequences/transcriptomes/Photeros_annecohenae*.fa
perl -pi -e 's/\>TRINITY/\>PMO_/g' sequences/transcriptomes/Photeros_morini*.fa
perl -pi -e 's/\>TRINITY/\>PMA_/g' sequences/transcriptomes/Photeros_macelroy*.fa
perl -pi -e 's/\>TRINITY/\>WLU_/g' sequences/transcriptomes/Photeros_sp_WLU_*.fa

perl -pi -e 's/\>TRINITY/\>VAD_/g' sequences/transcriptomes/Maristella_sp_VAD_*.fa
perl -pi -e 's/\>TRINITY/\>MCH_/g' sequences/transcriptomes/Maristella_chicoi_*.fa      
perl -pi -e 's/\>TRINITY/\>MAG_/g' sequences/transcriptomes/Maristella_sp_AG_*.fa       
perl -pi -e 's/\>TRINITY/\>SVD_/g' sequences/transcriptomes/Maristella_sp_SVD_*.fa      
perl -pi -e 's/\>TRINITY/\>SVU_/g' sequences/transcriptomes/Maristella_sp_SVU_*.fa      

perl -pi -e 's/\>TRINITY/\>KHA_/g' sequences/transcriptomes/Kornickeria_hastingsi_*.fa  


#ADD TOGETHER FOR BLAST DATABASE
cat sequences/transcriptomes/*_aa.fa > sequences/transcriptomes/allxtomes_aa.fasta
cat sequences/transcriptomes/*_nt.fa > sequences/transcriptomes/allxtomes_nt.fasta

#Use awk to get all sequence data on a single line instead of interleaved
awk '/^>/ {printf("%s%s\n",(N>0?"\n":""),$0);N++;next;}  {printf("%s",$0);} END {printf("\n");}' sequences/transcriptomes/allxtomes_aa.fasta > sequences/transcriptomes/allxtomes1_aa.fasta
#now only retain complete (full length) transcripts as labeled by transdecoder
grep -A 1 -Fw complete sequences/transcriptomes/allxtomes1_aa.fasta > sequences/transcriptomes/complete_transcripts.fasta

#makeblastdb -in sequences/transcriptomes/complete_transcripts.fasta -dbtype prot
blastp -query sequences/published/Vhilgendorfii_aa.fa -db sequences/transcriptomes/complete_transcripts.fasta > results/blast/blastresults.out

#Now get top scoring sequences from blast output by maipulating text files. Assumes ...__
#3-letter abbreviation for species at beginning of each sequence name
grep -A 20 -Fw 'Sequences producing' results/blast/blastresults.out | grep -oP '...__.+\:\:T' > results/blast/top20.txt
perl -pi -e 's/\:\:T//g' results/blast/top20.txt
grep -A 1 -Fwf results/blast/top20.txt sequences/transcriptomes/complete_transcripts.fasta > results/blast/besthits.fasta
perl -pi -e 's/\-\-//g' results/blast/besthits.fasta








